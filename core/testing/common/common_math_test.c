// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT license.

#include <stddef.h>
#include <stdint.h>
#include <string.h>
#include "testing.h"
#include "common/common_math.h"


TEST_SUITE_LABEL ("common_math");

// Table with number of bits set for every value from 0-255
uint8_t num_bits[] = {
	0x0,0x1,0x1,0x2,0x1,0x2,0x2,0x3,0x1,0x2,0x2,0x3,0x2,0x3,0x3,0x4,0x1,0x2,0x2,0x3,0x2,0x3,0x3,0x4,
	0x2,0x3,0x3,0x4,0x3,0x4,0x4,0x5,0x1,0x2,0x2,0x3,0x2,0x3,0x3,0x4,0x2,0x3,0x3,0x4,0x3,0x4,0x4,0x5,
	0x2,0x3,0x3,0x4,0x3,0x4,0x4,0x5,0x3,0x4,0x4,0x5,0x4,0x5,0x5,0x6,0x1,0x2,0x2,0x3,0x2,0x3,0x3,0x4,
	0x2,0x3,0x3,0x4,0x3,0x4,0x4,0x5,0x2,0x3,0x3,0x4,0x3,0x4,0x4,0x5,0x3,0x4,0x4,0x5,0x4,0x5,0x5,0x6,
	0x2,0x3,0x3,0x4,0x3,0x4,0x4,0x5,0x3,0x4,0x4,0x5,0x4,0x5,0x5,0x6,0x3,0x4,0x4,0x5,0x4,0x5,0x5,0x6,
	0x4,0x5,0x5,0x6,0x5,0x6,0x6,0x7,0x1,0x2,0x2,0x3,0x2,0x3,0x3,0x4,0x2,0x3,0x3,0x4,0x3,0x4,0x4,0x5,
	0x2,0x3,0x3,0x4,0x3,0x4,0x4,0x5,0x3,0x4,0x4,0x5,0x4,0x5,0x5,0x6,0x2,0x3,0x3,0x4,0x3,0x4,0x4,0x5,
	0x3,0x4,0x4,0x5,0x4,0x5,0x5,0x6,0x3,0x4,0x4,0x5,0x4,0x5,0x5,0x6,0x4,0x5,0x5,0x6,0x5,0x6,0x6,0x7,
	0x2,0x3,0x3,0x4,0x3,0x4,0x4,0x5,0x3,0x4,0x4,0x5,0x4,0x5,0x5,0x6,0x3,0x4,0x4,0x5,0x4,0x5,0x5,0x6,
	0x4,0x5,0x5,0x6,0x5,0x6,0x6,0x7,0x3,0x4,0x4,0x5,0x4,0x5,0x5,0x6,0x4,0x5,0x5,0x6,0x5,0x6,0x6,0x7,
	0x4,0x5,0x5,0x6,0x5,0x6,0x6,0x7,0x5,0x6,0x6,0x7,0x6,0x7,0x7,0x8
};


/*******************
 * Test cases
 *******************/

static void common_math_test_get_num_bits_set (CuTest *test)
{
	int status;
	int i;

	TEST_START;

	for (i = 0; i < 256; ++i) {
		status = common_math_get_num_bits_set (i);
		CuAssertIntEquals (test, num_bits[i], status);
	}
}

static void common_math_test_get_num_bits_set_before_index (CuTest *test)
{
	int status;
	int i;

	TEST_START;

	for (i = 0; i < 8; ++i) {
		status = common_math_get_num_bits_set_before_index (0xff, i);
		CuAssertIntEquals (test, i, status);
	}
}


TEST_SUITE_START (common_math);

TEST (common_math_test_get_num_bits_set);
TEST (common_math_test_get_num_bits_set_before_index);

TEST_SUITE_END;
